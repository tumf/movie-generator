# Change: Web サービス化（一般ユーザー向け公開）

## Why

現在の movie-generator は CLI ツールであり、技術者以外は使用できない。
ブラウザから URL を入力するだけで動画を生成できる Web サービスとして公開し、
一般ユーザーが利用できるようにする。

## What Changes

- **新規**: FastAPI による Web UI と API の追加
- **新規**: PocketBase によるジョブ管理・リアルタイム通知
- **新規**: Worker によるバックグラウンドジョブ処理
- **新規**: Docker Compose による本番デプロイ構成
- **新規**: 利用制限機能（レート制限、動画長制限など）
- 既存の CLI/ライブラリには変更なし

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    Traefik (既存・共用)                      │
│               movie.example.com → api:8000                  │
└─────────────────────────────────────────────────────────────┘
                              │
           ┌──────────────────┼──────────────────┐
           ▼                  ▼                  ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│   FastAPI       │  │   PocketBase    │  │    Worker       │
│   (api)         │  │   (db)          │  │                 │
│                 │  │                 │  │                 │
│ - HTML 配信     │  │ - jobs DB       │  │ - ジョブ監視    │
│ - フォーム処理  │◀─│ - Realtime API  │─▶│ - 動画生成      │
│ - 進捗表示     │  │ - Admin UI      │  │ - 進捗更新      │
│ (htmx polling)  │  │   (/admin)      │  │                 │
└─────────────────┘  └─────────────────┘  └─────────────────┘
                             │
                             ▼
                    ┌─────────────────┐
                    │    Volumes      │
                    │ - pb_data       │
                    │ - output/       │
                    └─────────────────┘
```

## 利用制限（デフォルト値）

| 項目 | 制限値 | 理由 |
|------|--------|------|
| 同時処理数 | 2 件 | VPS リソース保護 |
| 動画の長さ上限 | 5 分 | 処理時間・ストレージ節約 |
| 1日の利用回数 | 5 回/IP | abuse 防止 |
| 動画保存期間 | 24 時間 | ストレージ節約 |
| キュー待機上限 | 10 件 | 無制限投入防止 |

## Impact

- 新規 spec: `web-service`
- 影響する既存 spec: なし（CLI は変更しない）
- 影響するコード: なし（新規 `web/` ディレクトリに追加）

## 技術選定理由

### FastAPI + Jinja2 (フロントエンド)
- Python 統一でチーム学習コスト低
- htmx でシンプルなリアルタイム風 UI
- テンプレートベースで早期リリース向き

### PocketBase (DB + リアルタイム)
- 単一バイナリでセットアップ簡単
- Admin UI 標準搭載（ジョブ状況確認）
- Realtime API でフロントエンドへの通知が容易
- 将来の認証機能追加が容易

### Worker (ポーリング方式)
- 最もシンプルで確実
- PocketBase Realtime より実装が容易
- 5秒間隔のポーリングで十分なレスポンス

### Docker Compose + Traefik
- 既存の共用 VPS インフラを活用
- スケーラビリティより早期リリースを優先
